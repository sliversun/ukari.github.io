<html>
  <head>
    <title id="title">blog</title>
  </head>
  <body>
    <div id="notification"></div>
    <div id="article_lists"></div>
  </body>
</html>
<script src="js/request.js" type="text/javascript"></script>
<script src="js/js.cookie.js" type="text/javascript"></script>
<script language="javascript">
     base_request("GET", "http://"+window.location.host+"/config.json", undefined, load_config, document.getElementById("notification"));

     function load_config(data, target)
     {
       var list = Object.keys(data);
       for (var i in list) {
         var v = list[i];
         Cookies.set(v, data[v]);
         target.innerHTML += "load config: "+v+" = "+data[v]+newline();
       }
     }

     base_request("GET", gist_url(), undefined, get_articles, document.getElementById("article_lists"));

     function get_articles(data, target)
     {
       var file = data[0];
       var articles = new Array();
       for (var i = 0; i < data.length; i += 1) {
         if (articlep(data[i])) {
           articles[articles.length] = new article(data[i]);
         }
       }
       show_articles(articles);
       function show_articles(articles, target)
       {
         var buf = "";
         for (var i = 0; i < articles.length; i += 1){
           var a = articles[i];
           buf += divtag("article",
                         divtag("title", a.title) +
                         divtag("description", a.description));
         }
         target.innerHTML = buf;
       }
     }

     function divtag(id, content)
     {
       return "<div id="+id+">"+content+"</>";
     }

     function article(file)
     {
       var gist = file["files"][Object.keys(file["files"])];
       this.title = gist["filename"];
       this.raw_url = gist["raw_url"];
       var des = file["description"];
       this.description = des.substring(des.indexOf(" ") + 1, des.length);
     }

     function articlep(file)
     {
       var description = file["description"];
       var shebang = description.substring(0,description.indexOf(" "));
       return shebang == "#!unmj";
     }

     function gist_url()
     {
       var github_username = Cookies.get("github_username");
       var gist_url = "https://api.github.com/users/"+github_username+"/gists";
       return gist_url;
     }

     function newline()
     {
       return "<br>";
     }

</script>
